tenets:
  - name: find-funcs
    doc: Example tenet that finds unsafe variables in goroutines.
    flows:
      codelingo/review:
        comment: This variable is not safe to use in this goroutine.
    query: |
      import codelingo/ast/go

      go.func_decl(depth = any):
      # Repeated code under go.for_stmt and go.range_stmt - waiting for macrofacts
        any_of:
          go.range_stmt(depth = any):
            go.go_stmt(depth = any):
              go.expr_stmt(depth = any):
                @review.comment
                go.ident:
                  name as identName
              exclude:
                go.names(depth = any):
                  go.ident(depth = any):
                    name == identName
          go.for_stmt(depth = any):
            go.go_stmt(depth = any):
              go.expr_stmt(depth = any):
                @review.comment
                go.ident:
                  name as identName
              exclude:
                go.names:
                  go.ident(depth = any):
                    name == identName

